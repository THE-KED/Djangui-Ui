{"ast":null,"code":"import { HttpResponse } from '@angular/common/http';\nimport { of, tap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../Services/CacheResolverService\";\nconst TIME_TO_LIVE = 100;\nclass HttpCachingInterceptorInterceptor {\n  constructor(cache) {\n    this.cache = cache;\n  }\n  intercept(request, next) {\n    console.log(\"request\", request);\n    if (request.method != 'GET' || request.url.includes(\"/auth\")) {\n      return next.handle(request);\n    }\n    const cachedResponse = this.cache.get(request.url);\n    return cachedResponse ? of(cachedResponse) : this.sendRequest(request, next);\n  }\n  sendRequest(request, next) {\n    let ttl = this.cache.map(request.url);\n    return next.handle(request).pipe(tap(event => {\n      if (event instanceof HttpResponse) {\n        this.cache.set(request.urlWithParams, event, ttl);\n      }\n    }));\n  }\n  static #_ = this.ɵfac = function HttpCachingInterceptorInterceptor_Factory(t) {\n    return new (t || HttpCachingInterceptorInterceptor)(i0.ɵɵinject(i1.CacheResolverService));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: HttpCachingInterceptorInterceptor,\n    factory: HttpCachingInterceptorInterceptor.ɵfac\n  });\n}\nexport { HttpCachingInterceptorInterceptor };","map":{"version":3,"names":["HttpResponse","of","tap","TIME_TO_LIVE","HttpCachingInterceptorInterceptor","constructor","cache","intercept","request","next","console","log","method","url","includes","handle","cachedResponse","get","sendRequest","ttl","map","pipe","event","set","urlWithParams","_","i0","ɵɵinject","i1","CacheResolverService","_2","factory","ɵfac"],"sources":["/home/ked/backups/Angular/DanguiUi/src/app/http-interceptor/http-caching-interceptor.interceptor.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpEvent,\n  HttpInterceptor, HttpResponse\n} from '@angular/common/http';\nimport {Observable, of, tap} from 'rxjs';\nimport {CacheResolverService} from \"../Services/CacheResolverService\";\n\nconst TIME_TO_LIVE= 100;\n\n@Injectable()\nexport class HttpCachingInterceptorInterceptor implements HttpInterceptor {\n\n  constructor(private cache: CacheResolverService) {}\n\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n\n    console.log(\"request\",request);\n    if (request.method !='GET'||request.url.includes(\"/auth\")){\n      return next.handle(request);\n\n    }\n\n    const cachedResponse = this.cache.get(request.url);\n\n    return cachedResponse ? of(cachedResponse):this.sendRequest(request,next);\n  }\n\n  sendRequest(\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>>{\n\n    let ttl = this.cache.map(request.url);\n\n    return next.handle(request).pipe(\n      tap((event)=>{\n        if(event instanceof HttpResponse){\n          this.cache.set(request.urlWithParams,event,ttl);\n        }\n      })\n    )\n  };\n}\n"],"mappings":"AACA,SAImBA,YAAY,QACxB,sBAAsB;AAC7B,SAAoBC,EAAE,EAAEC,GAAG,QAAO,MAAM;;;AAGxC,MAAMC,YAAY,GAAE,GAAG;AAEvB,MACaC,iCAAiC;EAE5CC,YAAoBC,KAA2B;IAA3B,KAAAA,KAAK,GAALA,KAAK;EAAyB;EAElDC,SAASA,CAACC,OAAyB,EAAEC,IAAiB;IAEpDC,OAAO,CAACC,GAAG,CAAC,SAAS,EAACH,OAAO,CAAC;IAC9B,IAAIA,OAAO,CAACI,MAAM,IAAG,KAAK,IAAEJ,OAAO,CAACK,GAAG,CAACC,QAAQ,CAAC,OAAO,CAAC,EAAC;MACxD,OAAOL,IAAI,CAACM,MAAM,CAACP,OAAO,CAAC;;IAI7B,MAAMQ,cAAc,GAAG,IAAI,CAACV,KAAK,CAACW,GAAG,CAACT,OAAO,CAACK,GAAG,CAAC;IAElD,OAAOG,cAAc,GAAGf,EAAE,CAACe,cAAc,CAAC,GAAC,IAAI,CAACE,WAAW,CAACV,OAAO,EAACC,IAAI,CAAC;EAC3E;EAEAS,WAAWA,CACTV,OAAyB,EACzBC,IAAiB;IAGjB,IAAIU,GAAG,GAAG,IAAI,CAACb,KAAK,CAACc,GAAG,CAACZ,OAAO,CAACK,GAAG,CAAC;IAErC,OAAOJ,IAAI,CAACM,MAAM,CAACP,OAAO,CAAC,CAACa,IAAI,CAC9BnB,GAAG,CAAEoB,KAAK,IAAG;MACX,IAAGA,KAAK,YAAYtB,YAAY,EAAC;QAC/B,IAAI,CAACM,KAAK,CAACiB,GAAG,CAACf,OAAO,CAACgB,aAAa,EAACF,KAAK,EAACH,GAAG,CAAC;;IAEnD,CAAC,CAAC,CACH;EACH;EAAC,QAAAM,CAAA,G;qBA/BUrB,iCAAiC,EAAAsB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,oBAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAjC1B,iCAAiC;IAAA2B,OAAA,EAAjC3B,iCAAiC,CAAA4B;EAAA;;SAAjC5B,iCAAiC"},"metadata":{},"sourceType":"module","externalDependencies":[]}