{"ast":null,"code":"export function getDetteMontant(pret, versements) {\n  let montant = Number(pret.montant);\n  let lastVersementDate = versements.length > 0 ? versements[0].dateVersement : null;\n  let sommeVerser = 0;\n  let delay = 0;\n  //date du dernier versement et somme total deja verser\n  for (let verse of versements) {\n    if (verse.dateVersement) if (!lastVersementDate) {\n      lastVersementDate = new Date(verse.dateVersement.toString());\n    } else if (new Date(lastVersementDate.toString()).getTime() < new Date(verse.dateVersement.toString()).getTime()) {\n      lastVersementDate = new Date(verse.dateVersement.toString());\n    }\n    sommeVerser += Number(verse.montant);\n  }\n  //le delay ecouler depuis l'optention du pret\n  if (pret.datePret) {\n    delay = new Date().getTime() - new Date(pret.datePret.toString()).getTime();\n  }\n  let accorded = Number(pret.epargnant?.epargne?.delaisRemboursement);\n  let tauxInteret = Number(pret.epargnant?.epargne?.tauxInteretPret) / 100;\n  let verseDelay = 0;\n  if (lastVersementDate && pret.datePret) verseDelay = new Date(lastVersementDate.toString()).getTime() - new Date(pret.datePret.toString()).getTime();\n  montant += Number(pret.montant) * tauxInteret;\n  while (delay - accorded > 2592000000) {\n    if (verseDelay > 0) {\n      if (delay <= verseDelay && sommeVerser >= montant) {\n        break;\n      }\n    }\n    montant += montant * tauxInteret;\n    delay -= 2592000000;\n  }\n  return Math.round(montant);\n}","map":{"version":3,"names":["getDetteMontant","pret","versements","montant","Number","lastVersementDate","length","dateVersement","sommeVerser","delay","verse","Date","toString","getTime","datePret","accorded","epargnant","epargne","delaisRemboursement","tauxInteret","tauxInteretPret","verseDelay","Math","round"],"sources":["/home/ked/backups/Angular/DanguiUi/src/app/metier/getDetteMontant.ts"],"sourcesContent":["import {Pret} from \"../../Models/Entitys/Pret\";\nimport {Versement} from \"../../Models/Entitys/Versement\";\n\nexport function getDetteMontant(pret: Pret, versements: Versement[]):number{\n\n    let montant :number = Number(pret.montant);\n    let lastVersementDate :Date|null = versements.length>0? versements[0].dateVersement : null;\n    let sommeVerser :number = 0\n    let delay :number = 0;\n\n    //date du dernier versement et somme total deja verser\n    for (let verse of versements){\n        if (verse.dateVersement)\n            if(!lastVersementDate){\n                lastVersementDate = new Date(verse.dateVersement.toString());\n            }else if (new Date(lastVersementDate.toString()).getTime()<new Date(verse.dateVersement.toString()).getTime()){\n                lastVersementDate = new Date(verse.dateVersement.toString());\n            }\n\n        sommeVerser += Number(verse.montant);\n    }\n\n\n    //le delay ecouler depuis l'optention du pret\n    if (pret.datePret){\n        delay = new Date().getTime() - new Date(pret.datePret.toString()).getTime();\n    }\n\n    let accorded = Number(pret.epargnant?.epargne?.delaisRemboursement);\n    let tauxInteret = Number(pret.epargnant?.epargne?.tauxInteretPret)/100;\n    let verseDelay = 0;\n    if (lastVersementDate && pret.datePret)\n        verseDelay = new Date(lastVersementDate.toString()).getTime() - new Date(pret.datePret.toString()).getTime();\n\n    montant += (Number(pret.montant) * tauxInteret);\n\n    while ((delay - accorded)>2592000000){\n\n        if(verseDelay >0) {\n            if((delay <= verseDelay) && (sommeVerser)>=montant){\n                break;\n            }\n        }\n\n        montant += (montant * tauxInteret);\n\n        delay -= 2592000000;\n    }\n\n\n    return Math.round(montant);\n}"],"mappings":"AAGA,OAAM,SAAUA,eAAeA,CAACC,IAAU,EAAEC,UAAuB;EAE/D,IAAIC,OAAO,GAAWC,MAAM,CAACH,IAAI,CAACE,OAAO,CAAC;EAC1C,IAAIE,iBAAiB,GAAcH,UAAU,CAACI,MAAM,GAAC,CAAC,GAAEJ,UAAU,CAAC,CAAC,CAAC,CAACK,aAAa,GAAG,IAAI;EAC1F,IAAIC,WAAW,GAAW,CAAC;EAC3B,IAAIC,KAAK,GAAW,CAAC;EAErB;EACA,KAAK,IAAIC,KAAK,IAAIR,UAAU,EAAC;IACzB,IAAIQ,KAAK,CAACH,aAAa,EACnB,IAAG,CAACF,iBAAiB,EAAC;MAClBA,iBAAiB,GAAG,IAAIM,IAAI,CAACD,KAAK,CAACH,aAAa,CAACK,QAAQ,EAAE,CAAC;KAC/D,MAAK,IAAI,IAAID,IAAI,CAACN,iBAAiB,CAACO,QAAQ,EAAE,CAAC,CAACC,OAAO,EAAE,GAAC,IAAIF,IAAI,CAACD,KAAK,CAACH,aAAa,CAACK,QAAQ,EAAE,CAAC,CAACC,OAAO,EAAE,EAAC;MAC1GR,iBAAiB,GAAG,IAAIM,IAAI,CAACD,KAAK,CAACH,aAAa,CAACK,QAAQ,EAAE,CAAC;;IAGpEJ,WAAW,IAAIJ,MAAM,CAACM,KAAK,CAACP,OAAO,CAAC;;EAIxC;EACA,IAAIF,IAAI,CAACa,QAAQ,EAAC;IACdL,KAAK,GAAG,IAAIE,IAAI,EAAE,CAACE,OAAO,EAAE,GAAG,IAAIF,IAAI,CAACV,IAAI,CAACa,QAAQ,CAACF,QAAQ,EAAE,CAAC,CAACC,OAAO,EAAE;;EAG/E,IAAIE,QAAQ,GAAGX,MAAM,CAACH,IAAI,CAACe,SAAS,EAAEC,OAAO,EAAEC,mBAAmB,CAAC;EACnE,IAAIC,WAAW,GAAGf,MAAM,CAACH,IAAI,CAACe,SAAS,EAAEC,OAAO,EAAEG,eAAe,CAAC,GAAC,GAAG;EACtE,IAAIC,UAAU,GAAG,CAAC;EAClB,IAAIhB,iBAAiB,IAAIJ,IAAI,CAACa,QAAQ,EAClCO,UAAU,GAAG,IAAIV,IAAI,CAACN,iBAAiB,CAACO,QAAQ,EAAE,CAAC,CAACC,OAAO,EAAE,GAAG,IAAIF,IAAI,CAACV,IAAI,CAACa,QAAQ,CAACF,QAAQ,EAAE,CAAC,CAACC,OAAO,EAAE;EAEhHV,OAAO,IAAKC,MAAM,CAACH,IAAI,CAACE,OAAO,CAAC,GAAGgB,WAAY;EAE/C,OAAQV,KAAK,GAAGM,QAAQ,GAAE,UAAU,EAAC;IAEjC,IAAGM,UAAU,GAAE,CAAC,EAAE;MACd,IAAIZ,KAAK,IAAIY,UAAU,IAAMb,WAAW,IAAGL,OAAO,EAAC;QAC/C;;;IAIRA,OAAO,IAAKA,OAAO,GAAGgB,WAAY;IAElCV,KAAK,IAAI,UAAU;;EAIvB,OAAOa,IAAI,CAACC,KAAK,CAACpB,OAAO,CAAC;AAC9B"},"metadata":{},"sourceType":"module","externalDependencies":[]}