{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../Services/tontine-service.service\";\nimport * as i3 from \"../../Services/bilan-service.service\";\nimport * as i4 from \"@angular/material/button\";\nlet CheckgratuitComponent = /*#__PURE__*/(() => {\n  class CheckgratuitComponent {\n    constructor(router, tontineService, bilanServ, route) {\n      this.router = router;\n      this.tontineService = tontineService;\n      this.bilanServ = bilanServ;\n      this.route = route;\n      this.dataSource = [];\n      this.nbParts = [];\n      this.nbRetards = [];\n      this.nbPaidEchec = [];\n      this.nbNonPaidEchec = [];\n      this.nom = \"\";\n      this.nbToureGratuit = 0;\n      this.totalRetrad = 0;\n      this.totalEchecPaid = 0;\n      this.TotalComplement = 0;\n      this.totalTontine = 0;\n      this.totalEchecNonPaid = 0;\n      this.total = 0;\n      this.supplement = 0;\n      this.totalSupplement = 0;\n      this.totalBoisson = 0;\n      this.totalGratuit = 0;\n      this.type = \"Vente\";\n      this.membres = [];\n      this.visibility = \"invisible\";\n      this.totalCaisse = 0;\n    }\n    ngOnInit() {\n      this.idTontine = this.router.snapshot.params[\"id\"];\n      this.tontine = JSON.parse(this.router.snapshot.params[\"ton\"]);\n      this.type = this.tontine.type.nom;\n      if (this.tontine.type.code != 1) this.route.navigateByUrl(\"public/start/seances/\" + this.idTontine);\n      this.tontineService.loadMembre(this.idTontine).subscribe(data => {\n        this.membres = data;\n        this.tontineService.getCotisation(this.idTontine).subscribe(data => {\n          this.dataSource = data;\n          if (this.dataSource.length > 0) this.nom = data[0].nom;\n          for (let cot of data) {\n            if (cot.gratuit) this.nbToureGratuit++;\n          }\n          this.bilanServ.getNbCotisation(this.idTontine).subscribe(data => {\n            // console.log(data);\n            this.nbParts = data;\n            this.bilanServ.getNbRetard(this.idTontine).subscribe(data => {\n              this.nbRetards = data;\n              this.bilanServ.getNbPaidEchec(this.idTontine).subscribe(data => {\n                this.nbPaidEchec = data;\n                this.bilanServ.getNbNonPaidEchec(this.idTontine).subscribe(data => {\n                  this.nbNonPaidEchec = data;\n                  let seuil = this.tontine.nbSeances * this.tontine.tauxTontine;\n                  this.getTotal();\n                  console.log(\"membres:\", this.membres.length, \"seuil:\", seuil, \"total:\", this.totalCaisse);\n                  if (this.totalCaisse < seuil) {\n                    this.route.navigateByUrl(\"public/start/seances/\" + this.idTontine);\n                  }\n                  this.visibility = \"visible\";\n                }, error => {}, () => {\n                  let seuil = this.tontine.nbSeances * this.tontine.tauxTontine;\n                  console.log(\"seuil: \", seuil, \"total: \", this.totalCaisse);\n                  if (this.totalCaisse < seuil) {\n                    console.log(\"seuil: \", seuil, \"total: \", this.totalCaisse);\n                    this.route.navigateByUrl(\"public/start/seances/\" + this.idTontine);\n                  }\n                });\n              });\n            });\n          });\n        });\n      });\n    }\n    ngDoCheck() {}\n    // renvoie le nombre de participation qu'il y'a eu lors d'un une cotiastion\n    nbPart(idCot, rang) {\n      let cot = this.dataSource[rang - 1];\n      for (let part of this.nbParts) {\n        if (part[0] == idCot) {\n          return part[1];\n        }\n      }\n      return 0;\n    }\n    getTotal() {\n      this.total = 0;\n      this.totalTontine = 0;\n      this.totalEchecPaid = 0;\n      this.totalRetrad = 0;\n      this.TotalComplement = 0;\n      this.totalBoisson = 0;\n      this.totalGratuit = 0;\n      this.totalEchecNonPaid = 0;\n      this.totalCaisse = 0;\n      for (let cot of this.dataSource) {\n        if (this.type == \"Vente\") this.totalTontine += cot.tauxVente;\n        if (this.type == \"Simple\") this.totalTontine += this.tontine.tauxTontine;\n        this.TotalComplement += cot.complement;\n        if (cot.id) if (this.nbPart(cot.id, cot.rang) > this.tontine.nbSeances) {\n          console.log(\"nb_part:\", this.nbPart(cot.id, cot.rang));\n          this.totalSupplement += cot.tauxTontine * (this.nbPart(cot.id, cot.rang) - this.tontine.nbSeances);\n        }\n        this.totalBoisson += cot.tauxTontine;\n        if (cot.gratuit && cot.id) {\n          this.totalGratuit += cot.tauxTontine * this.nbPart(cot.id, cot.rang);\n        }\n        for (let retar of this.nbRetards) {\n          if (retar[0] == cot.id) {\n            if (this.type == \"Vente\") this.totalRetrad += retar[1] * cot.tauxEchec;\n            if (this.type == \"Simple\") this.totalRetrad += retar[1] * this.tontine.tauxRetard;\n          }\n        }\n        for (let echec of this.nbPaidEchec) {\n          if (echec[0] == cot.id) {\n            if (this.type == \"Vente\") this.totalEchecPaid += echec[1] * (cot.tauxEchec + cot.tauxTontine);\n            if (this.type == \"Simple\") this.totalEchecPaid += echec[1] * (this.tontine.tauxEchec + cot.tauxTontine);\n          }\n        }\n        for (let echec of this.nbNonPaidEchec) {\n          if (echec[0] == cot.id) {\n            if (this.type == \"Vente\") this.totalEchecNonPaid += echec[1] * cot.tauxEchec;\n            if (this.type == \"Simple\") this.totalEchecNonPaid += echec[1] * this.tontine.tauxEchec;\n          }\n        }\n      }\n      console.log(\"supp:\", this.totalSupplement);\n      this.totalCaisse = this.totalTontine + this.totalRetrad + this.totalEchecPaid + this.totalSupplement - (this.TotalComplement + this.totalBoisson + this.totalGratuit);\n    }\n    static #_ = this.ɵfac = function CheckgratuitComponent_Factory(t) {\n      return new (t || CheckgratuitComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.TontineServiceService), i0.ɵɵdirectiveInject(i3.BilanServiceService), i0.ɵɵdirectiveInject(i1.Router));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: CheckgratuitComponent,\n      selectors: [[\"app-checkgratuit\"]],\n      decls: 8,\n      vars: 4,\n      consts: [[1, \"list\"], [\"mat-raised-button\", \"\", 1, \"gratuit\", 3, \"routerLink\"], [\"mat-raised-button\", \"\", 3, \"routerLink\"]],\n      template: function CheckgratuitComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\")(1, \"div\", 0)(2, \"h2\");\n          i0.ɵɵtext(3, \"Presense d'un tour gratuit\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"button\", 1);\n          i0.ɵɵtext(5, \" Demarer Le tour gratuit \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"button\", 2);\n          i0.ɵɵtext(7, \" Continuer une cotisation normal \");\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵclassMap(ctx.visibility);\n          i0.ɵɵadvance(4);\n          i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/public/start/gratuit/\", ctx.idTontine, \"\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵpropertyInterpolate1(\"routerLink\", \"/public/start/seances/\", ctx.idTontine, \"\");\n        }\n      },\n      dependencies: [i1.RouterLink, i4.MatButton],\n      styles: [\".visible[_ngcontent-%COMP%], .invisible[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}.list[_ngcontent-%COMP%]{background-color:#fff;background-color:#ffffff26;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:#efefef;border:1px solid rgba(255,255,255,.7);border-radius:1%;box-shadow:0 25px 35px #262626cc;margin:65px 0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2em;padding:3em 5em}button[_ngcontent-%COMP%]{width:100%!important;padding:2em 8em!important}button.gratuit[_ngcontent-%COMP%]{background-color:#00fa9a}.invisible[_ngcontent-%COMP%]{opacity:0}.visible[_ngcontent-%COMP%]{opacity:1}\"]\n    });\n  }\n  return CheckgratuitComponent;\n})();\nexport { CheckgratuitComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}