{"ast":null,"code":"import { getDetteMontant } from \"../../metier/getDetteMontant\";\nimport { BuyPretDialogComponent } from \"../../dialogbox/buy-pret-dialog/buy-pret-dialog.component\";\nimport { forkJoin, tap } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../Services/epargne.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/material/dialog\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/table\";\nimport * as i7 from \"@angular/material/grid-list\";\nfunction BuyPretComponent_th_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" No. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r19 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i_r19 + 1, \" \");\n  }\n}\nfunction BuyPretComponent_th_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" Nom \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r20 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r20.epargnant.membre.nom, \" \");\n  }\n}\nfunction BuyPretComponent_th_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" Montant \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19)(1, \"span\", 20);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const element_r21 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(element_r21.montant);\n  }\n}\nfunction BuyPretComponent_th_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" Montant + interet \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19)(1, \"span\", 20);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const i_r24 = ctx.index;\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r7.getPretvalue(i_r24));\n  }\n}\nfunction BuyPretComponent_th_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" Date pret \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const element_r25 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", element_r25.datePret, \" \");\n  }\n}\nfunction BuyPretComponent_th_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" Reste a Verser \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r27 = ctx.index;\n    const ctx_r11 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r11.restes[i_r27], \" \");\n  }\n}\nfunction BuyPretComponent_th_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \" Deja verser \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r29 = ctx.index;\n    const ctx_r13 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r13.dejaVerse[i_r29]);\n  }\n}\nfunction BuyPretComponent_th_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 18);\n    i0.ɵɵtext(1, \"Payer\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_27_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r36 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function BuyPretComponent_td_27_button_1_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r36);\n      const ctx_r35 = i0.ɵɵnextContext();\n      const element_r30 = ctx_r35.$implicit;\n      const i_r31 = ctx_r35.index;\n      const ctx_r34 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r34.openDialogBox(300, 100, element_r30, i_r31));\n    });\n    i0.ɵɵtext(1, \" Payer \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction BuyPretComponent_td_27_h4_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\", 24);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r31 = i0.ɵɵnextContext().index;\n    const ctx_r33 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Paye le :\", i0.ɵɵpipeBind2(2, 1, ctx_r33.lastVersementDate(i_r31), \"yyyy-MM-dd\"), \"\");\n  }\n}\nfunction BuyPretComponent_td_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 19);\n    i0.ɵɵtemplate(1, BuyPretComponent_td_27_button_1_Template, 2, 0, \"button\", 21);\n    i0.ɵɵtemplate(2, BuyPretComponent_td_27_h4_2_Template, 3, 4, \"h4\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const i_r31 = ctx.index;\n    const ctx_r15 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r15.isDone(i_r31));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r15.isDone(i_r31));\n  }\n}\nfunction BuyPretComponent_tr_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 25);\n  }\n}\nfunction BuyPretComponent_tr_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 26);\n  }\n}\nlet BuyPretComponent = /*#__PURE__*/(() => {\n  class BuyPretComponent {\n    constructor(epargneService, activatedRoute, dialogBox, cdr) {\n      this.epargneService = epargneService;\n      this.activatedRoute = activatedRoute;\n      this.dialogBox = dialogBox;\n      this.cdr = cdr;\n      this.displayedColumns = ['position', 'name', 'montant', 'pret', 'datePret', 'rembourse', 'verser', 'action'];\n      this.dataSource = [];\n      this.dataVerse = new Map();\n      this.dejaVerse = [];\n      this.restes = [];\n    }\n    ngOnInit() {\n      let snapshot = this.activatedRoute.snapshot;\n      let tempVerse = [];\n      this.epargne = JSON.parse(snapshot.params[\"ep\"]);\n      let pretCall = this.epargneService.getDetteByEpargnes(Number(this.epargne.id));\n      let verseCall = this.epargneService.getAllVerseByEpargnes(Number(this.epargne.id));\n      forkJoin([pretCall, verseCall]).pipe(tap(data => {\n        this.dataSource = data[0];\n        console.log(\"########## is done ##########\", data[0], data[1]);\n        for (let verse of data[1]) {\n          if (verse.pret?.id) {\n            if (this.dataVerse.has(verse.pret?.id)) {\n              tempVerse = this.dataVerse.get(verse.pret.id);\n              tempVerse.push(verse);\n              this.dataVerse.set(verse.pret.id, tempVerse);\n            } else {\n              tempVerse = [];\n              tempVerse.push(verse);\n              this.dataVerse.set(verse.pret.id, tempVerse);\n            }\n          }\n        }\n        console.log(\"dataverse : \", this.dataVerse);\n        let i = 0;\n        for (let pret of this.dataSource) {\n          if (!this.dataVerse.has(Number(pret.id))) {\n            this.dejaVerse.push(0);\n            this.restes.push(this.getPretvalue(i));\n          } else {\n            let somme = 0;\n            // if(this.dataVerse.get(Number(pret.id)))\n            for (let verse of this.dataVerse.get(Number(pret.id))) {\n              somme += Number(verse.montant);\n            }\n            this.dejaVerse.push(somme);\n            this.restes.push(this.getPretvalue(i) - somme);\n          }\n          i++;\n        }\n      })).subscribe(() => {\n        this.cdr.markForCheck();\n      });\n    }\n    checkBuy(element) {\n      return false;\n    }\n    getPretvalue(index) {\n      let versements = this.dataVerse.get(Number(this.dataSource[index].id)) ? this.dataVerse.get(Number(this.dataSource[index].id)) : [];\n      return getDetteMontant(this.dataSource[index], versements);\n    }\n    isDone(index) {\n      return this.restes[index] <= 0 ? false : true;\n    }\n    lastVersementDate(index) {\n      let lastVersementDate;\n      for (let verse of this.dataVerse.get(index)) {\n        if (verse.dateVersement) if (!lastVersementDate) {\n          lastVersementDate = new Date(verse.dateVersement.toString());\n        } else if (new Date(lastVersementDate.toString()).getTime() < new Date(verse.dateVersement.toString()).getTime()) {\n          lastVersementDate = new Date(verse.dateVersement.toString());\n        }\n      }\n      return lastVersementDate;\n    }\n    openDialogBox(enterDuration, exitDuration, pret, index) {\n      console.log(pret);\n      this.dialogBox.open(BuyPretDialogComponent, {\n        width: '400px',\n        enterAnimationDuration: enterDuration,\n        exitAnimationDuration: exitDuration,\n        data: pret\n      }).afterClosed().subscribe(data => {\n        if (data && data.data) {\n          console.log(\"close\", data.data);\n          let tempVerse = [];\n          if (this.dataVerse.has(data.data.pret?.id)) {\n            tempVerse = this.dataVerse.get(data.data.pret?.id);\n            tempVerse.push(data.data);\n            this.dataVerse.set(data.data.pret?.id, tempVerse);\n          } else {\n            tempVerse = [];\n            tempVerse.push(data.data);\n            this.dataVerse.set(data.data.pret?.id, tempVerse);\n          }\n          this.dejaVerse[index] += Number(data.data.montant);\n          this.restes[index] -= Number(data.data.montant);\n        }\n        this.cdr.markForCheck();\n      });\n    }\n    static #_ = this.ɵfac = function BuyPretComponent_Factory(t) {\n      return new (t || BuyPretComponent)(i0.ɵɵdirectiveInject(i1.EpargneService), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.MatDialog), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: BuyPretComponent,\n      selectors: [[\"app-buy-pret\"]],\n      decls: 38,\n      vars: 4,\n      consts: [[1, \"content\"], [1, \"tab\"], [1, \"pan\"], [\"mat-table\", \"\", 1, \"mat-elevation-z8\", 3, \"dataSource\"], [\"matColumnDef\", \"position\"], [\"mat-header-cell\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [\"matColumnDef\", \"name\"], [\"matColumnDef\", \"montant\"], [\"matColumnDef\", \"pret\"], [\"matColumnDef\", \"datePret\"], [\"matColumnDef\", \"rembourse\"], [\"matColumnDef\", \"verser\"], [\"matColumnDef\", \"action\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\"], [\"mat-row\", \"\", 4, \"matRowDef\", \"matRowDefColumns\"], [\"rowHeight\", \"50px\", 3, \"cols\"], [\"title\", \"INFORMATION\"], [\"mat-header-cell\", \"\"], [\"mat-cell\", \"\"], [1, \"lab\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"success\", 4, \"ngIf\"], [\"mat-flat-button\", \"\", \"color\", \"primary\", 3, \"click\"], [1, \"success\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\"]],\n      template: function BuyPretComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n          i0.ɵɵelement(2, \"span\", 2);\n          i0.ɵɵelementStart(3, \"table\", 3);\n          i0.ɵɵelementContainerStart(4, 4);\n          i0.ɵɵtemplate(5, BuyPretComponent_th_5_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(6, BuyPretComponent_td_6_Template, 2, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(7, 7);\n          i0.ɵɵtemplate(8, BuyPretComponent_th_8_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(9, BuyPretComponent_td_9_Template, 2, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(10, 8);\n          i0.ɵɵtemplate(11, BuyPretComponent_th_11_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(12, BuyPretComponent_td_12_Template, 3, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(13, 9);\n          i0.ɵɵtemplate(14, BuyPretComponent_th_14_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(15, BuyPretComponent_td_15_Template, 3, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(16, 10);\n          i0.ɵɵtemplate(17, BuyPretComponent_th_17_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(18, BuyPretComponent_td_18_Template, 2, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(19, 11);\n          i0.ɵɵtemplate(20, BuyPretComponent_th_20_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(21, BuyPretComponent_td_21_Template, 2, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(22, 12);\n          i0.ɵɵtemplate(23, BuyPretComponent_th_23_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(24, BuyPretComponent_td_24_Template, 2, 1, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(25, 13);\n          i0.ɵɵtemplate(26, BuyPretComponent_th_26_Template, 2, 0, \"th\", 5);\n          i0.ɵɵtemplate(27, BuyPretComponent_td_27_Template, 3, 2, \"td\", 6);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵtemplate(28, BuyPretComponent_tr_28_Template, 1, 0, \"tr\", 14);\n          i0.ɵɵtemplate(29, BuyPretComponent_tr_29_Template, 1, 0, \"tr\", 15);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"span\", 2)(31, \"mat-grid-list\", 16);\n          i0.ɵɵelement(32, \"mat-grid-tile-header\", 17)(33, \"mat-grid-tile\")(34, \"mat-grid-tile\")(35, \"mat-grid-tile\")(36, \"mat-grid-tile\")(37, \"mat-grid-tile\");\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"dataSource\", ctx.dataSource.slice());\n          i0.ɵɵadvance(25);\n          i0.ɵɵproperty(\"matHeaderRowDef\", ctx.displayedColumns);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"matRowDefColumns\", ctx.displayedColumns);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"cols\", 3);\n        }\n      },\n      dependencies: [i4.NgIf, i5.MatButton, i6.MatTable, i6.MatHeaderCellDef, i6.MatHeaderRowDef, i6.MatColumnDef, i6.MatCellDef, i6.MatRowDef, i6.MatHeaderCell, i6.MatCell, i6.MatHeaderRow, i6.MatRow, i7.MatGridList, i7.MatGridTile, i7.MatGridTileText, i7.MatGridTileHeaderCssMatStyler, i4.DatePipe],\n      styles: [\".content[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;align-items:center;justify-content:center}.tab[_ngcontent-%COMP%]{width:85%;margin:45px 0 75px;background-color:#fff9;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.7);border-radius:10px;padding:0 40px}table[_ngcontent-%COMP%]{width:65%;height:50%;background:none;box-shadow:none}.echec[_ngcontent-%COMP%]{display:inline-flex;min-width:35px}.pan[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:15px 0 0}.pan[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:95%;margin:10px}.pan[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]{margin-top:25px;width:95%;display:flex;flex-direction:row;justify-content:space-evenly}.lab[_ngcontent-%COMP%]{color:#4169e1}.inf[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-evenly;margin:5px 0 10px;font-weight:700}.success[_ngcontent-%COMP%]{color:#4169e1}.mat-mdc-row[_ngcontent-%COMP%]   .ben[_ngcontent-%COMP%]{background-color:#ffdf7ebf!important}mat-grid-list[_ngcontent-%COMP%]{width:100%}\"]\n    });\n  }\n  return BuyPretComponent;\n})();\nexport { BuyPretComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}